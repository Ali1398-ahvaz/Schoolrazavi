<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ÙØ±Ù… Ù‡ÙØªÚ¯ÛŒ Ø¨Ø§ ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{font-family:'Vazir',sans-serif;padding:10px;background:#f7fbfd;direction:rtl;}
table{border-collapse:collapse;width:100%;margin-top:10px;}
th,td{border:1px solid #ccc;padding:6px;text-align:center;vertical-align:middle;}
th{background:#0f4c75;color:#fff;}
.filled{background:#c8f7c5;}
input,select{padding:4px;width:100%;margin-bottom:2px;}
.controls{margin-top:10px;display:flex;gap:5px;flex-wrap:wrap;}
button{padding:6px 10px;border:none;background:#0f4c75;color:#fff;border-radius:6px;cursor:pointer;}
.inline{display:flex;gap:4px;justify-content:center;align-items:center;}
</style>
</head>
<body>

<h2>ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙØªÚ¯ÛŒ â€” Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h2>
<div id="summary">Ø®Ù„Ø§ØµÙ‡: Ù‡Ù†ÙˆØ² Ù¾Ø± Ù†Ø´Ø¯Ù‡</div>

<table id="scheduleTable">
  <thead>
    <tr>
      <th>Ø±ÙˆØ²</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
      <th>Ù†ÙˆØ¨Øª 1</th>
      <th>Ù†ÙˆØ¨Øª 2</th>
      <th>Ù†ÙˆØ¨Øª 3</th>
      <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="controls">
<button id="saveLocal">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
<button id="toPdf">ğŸ“„ PDF</button>
<button id="whatsapp">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ù¾</button>
<button id="email">âœ‰ï¸ Ø§ÛŒÙ…ÛŒÙ„</button>
</div>

<script>
const days=['Ø´Ù†Ø¨Ù‡','ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡'];
const lessons=['','Ø±ÛŒØ§Ø¶ÛŒ','Ø¹Ù„ÙˆÙ…','Ø§Ø¯Ø¨ÛŒØ§Øª','Ø¹Ø±Ø¨ÛŒ','Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ','Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ','Ù…Ø±ÙˆØ±'];
const hours=['','Û·','Û¸','Û¹','Û±Û°','Û±Û±','Û±Û²','Û±Û³','Û±Û´','Û±Ûµ','Û±Û¶','Û±Û·','Û±Û¸','Û±Û¹','Û²Û°','Û²Û±','Û²Û²'];
const tbody=document.querySelector('#scheduleTable tbody');
const summaryEl=document.getElementById('summary');
const managerPhone='989367104429';
const managerEmail='favasystemyallali@gmail.com';

// Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„
days.forEach((day,i)=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td>${day}</td>
    <td><input type="text" class="date" name="date_${i}"></td>
    ${[0,1,2].map(n=>`
      <td>
        <select class="lesson" name="lesson_${n}_${i}">${lessons.map(l=>`<option value="${l}">${l||'Ø¯Ø±Ø³'}</option>`).join('')}</select>
        <div class="inline">
          <select class="from" name="from_${n}_${i}">${hours.map(h=>`<option value="${h}">${h||'Ø§Ø²'}</option>`).join('')}</select>
          <span>ØªØ§</span>
          <select class="to" name="to_${n}_${i}">${hours.map(h=>`<option value="${h}">${h||'ØªØ§'}</option>`).join('')}</select>
        </div>
      </td>`).join('')}
    <td><input type="text" class="note" name="note_${i}"></td>
  `;
  tbody.appendChild(tr);
});

// ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ
$(document).ready(function(){
  $(".date").each(function(){
    $(this).persianDatepicker({
      format: 'YYYY/MM/DD',
      initialValue: true,
      autoClose: true,
      onSelect: function(){
        markAndSave(this);
      }
    });
  });
});

// Ø±Ù†Ú¯ Ø³Ù„ÙˆÙ„ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ
function markAndSave(el){
  const cell=el.closest('td');
  if(el.value.trim()!=='') cell.classList.add('filled');
  else cell.classList.remove('filled');
  localStorage.setItem(el.name,el.value);
  updateSummary();
}

// Ø§Ø¯Ø§Ù…Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§
function autoFillNext(fromEl){
  const td=fromEl.closest('td');
  const tr=td.closest('tr');
  const tds=Array.from(tr.querySelectorAll('td')).filter(td=>td.querySelector('select.from'));
  for(let i=0;i<tds.length-1;i++){
    if(tds[i].contains(fromEl)){
      const nextFrom=tds[i+1].querySelector('select.from');
      const nextTo=tds[i+1].querySelector('select.to');
      if(nextFrom.value==='' && fromEl.value!==''){
        nextFrom.value=fromEl.value;
        nextTo.value='';
        markAndSave(nextFrom);
        markAndSave(nextTo);
      }
      break;
    }
  }
}

document.querySelectorAll('input, select').forEach(el=>{
  if(localStorage.getItem(el.name)) el.value=localStorage.getItem(el.name);
  markAndSave(el);
  el.addEventListener('input', ()=>markAndSave(el));
  el.addEventListener('change', ()=>{
    markAndSave(el);
    if(el.classList.contains('to')) autoFillNext(el);
  });
});

// Ø®Ù„Ø§ØµÙ‡ ÙØ±Ù…
function updateSummary(){
  let filledCount=0;
  document.querySelectorAll('select').forEach(s=>{if(s.value) filledCount++;});
  summaryEl.textContent=`Ø®Ù„Ø§ØµÙ‡: ${filledCount} Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡`;
}

// Ø°Ø®ÛŒØ±Ù‡ Ú©Ù„ ÙØ±Ù…
document.getElementById('saveLocal').addEventListener('click', ()=>{
  document.querySelectorAll('input, select').forEach(el=>localStorage.setItem(el.name,el.value));
  alert('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
});

// PDF
document.getElementById('toPdf').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:'landscape'});
  let text='ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙØªÚ¯ÛŒ\n\n';
  days.forEach((day,i)=>{
    text+=day+' | '+document.querySelector(`[name=date_${i}]`).value+' | ';
    for(let n=0;n<3;n++){
      text+=document.querySelector(`[name=lesson_${n}_${i}]`).value+' ';
      text+=document.querySelector(`[name=from_${n}_${i}]`).value+' ØªØ§ ';
      text+=document.querySelector(`[name=to_${n}_${i}]`).value+' | ';
    }
    text+=document.querySelector(`[name=note_${i}]`).value+'\n';
  });
  doc.text(text,10,10);
  doc.save('weekly_schedule.pdf');
});

// ÙˆØ§ØªØ³Ø§Ù¾
document.getElementById('whatsapp').addEventListener('click', ()=>{
  let msg='ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯.%0A';
  days.forEach((day,i)=>{
    msg+=day+': ';
    for(let n=0;n<3;n++){
      msg+=document.querySelector(`[name=lesson_${n}_${i}]`).value+' ';
      msg+=document.querySelector(`[name=from_${n}_${i}]`).value+' ØªØ§ ';
      msg+=document.querySelector(`[name=to_${n}_${i}]`).value+' | ';
    }
    msg+=document.querySelector(`[name=note_${i}]`).value+'%0A';
  });
  window.open(`https://wa.me/${managerPhone}?text=${msg}`,'_blank');
});

// Ø§ÛŒÙ…ÛŒÙ„
document.getElementById('email').addEventListener('click', ()=>{
  let body='ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯.%0A';
  days.forEach((day,i)=>{
    body+=day+': ';
    for(let n=0;n<3;n++){
      body+=document.querySelector(`[name=lesson_${n}_${i}]`).value+' ';
      body+=document.querySelector(`[name=from_${n}_${i}]`).value+' ØªØ§ ';
      body+=document.querySelector(`[name=to_${n}_${i}]`).value+' | ';
    }
    body+=document.querySelector(`[name=note_${i}]`).value+'%0A';
  });
  window.open(`mailto:${managerEmail}?subject=ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ&body=${body}`,'_blank');
});
</script>

</body>
</html>
