<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙØªÚ¯ÛŒ â€” Schoolrazavi</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
<style>
:root{--primary:#0f4c75;--muted:#f7fbfd;--row1:#ffffff;--row2:#f3f9fc;--text:#143243}
body{font-family:'Vazir',sans-serif;background:var(--muted);color:var(--text);margin:0;padding:14px;direction:rtl}
.container{max-width:980px;margin:8px auto;background:#fff;border-radius:10px;padding:14px;box-shadow:0 6px 20px rgba(10,30,40,0.06)}
.header{display:flex;align-items:center;gap:12px;border-bottom:2px solid var(--primary);padding-bottom:10px}
.brand{display:flex;align-items:center;gap:8px}
.brand img{width:44px;height:44px;object-fit:contain;border-radius:6px}
h1{flex:1;font-size:16px;color:var(--primary);margin:0;text-align:center}
.meta{font-size:12px;color:#456}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
label{font-weight:700;font-size:13px}
input,select,textarea{font-family:'Vazir',sans-serif}
input,select{width:100%;padding:6px;border:1px solid #e1eef6;border-radius:6px;font-size:13px}
.small-input{width:44px;padding:6px 4px;text-align:center;font-size:13px}
.small-select{padding:4px 6px;font-size:12px;border-radius:6px}
.full{grid-column:1/-1}
.table-wrap{overflow:auto;margin-top:8px}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border:1px solid #e6f0f6;text-align:center;vertical-align:middle}
th{background:var(--primary);color:#fff;font-weight:700}
tbody tr:nth-child(odd){background:var(--row1)}
tbody tr:nth-child(even){background:var(--row2)}
.day-cell{font-weight:700}
.schedule-cell{white-space:nowrap}
.inline{display:inline-flex;align-items:center;gap:6px;justify-content:center}
.controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end;margin-top:12px}
.btn{background:var(--primary);color:#fff;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-size:13px}
.btn.ghost{background:transparent;color:var(--primary);border:1px solid #d6eaf4}
.note{font-size:12px;color:#556;margin-top:8px;text-align:left}
.chrome-launch{text-align:center;margin-top:12px}
.chrome-launch a{display:inline-block;background:#2b7da3;color:#fff;padding:8px 12px;border-radius:8px;text-decoration:none}
@media(max-width:820px){.form-grid{grid-template-columns:1fr}th,td{font-size:12px} .small-input{width:38px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Emblem_of_Iran.svg/120px-Emblem_of_Iran.svg.png" alt="Ø¢Ø±Ù…">
      <img src="https://files.virgool.io/upload/users/1605210/posts/n8ihxhpij7op/ku69kkvrogtv.jpg" alt="Ù„ÙˆÚ¯Ùˆ">
    </div>
    <h1>ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙØªÚ¯ÛŒ â€” Schoolrazavi</h1>
    <div class="meta" id="summary">Ø®Ù„Ø§ØµÙ‡: Ù‡Ù†ÙˆØ² Ù¾Ø± Ù†Ø´Ø¯Ù‡</div>
  </div>

  <div class="form-grid" role="form">
    <div>
      <label for="studentName">Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</label>
      <input id="studentName" name="studentName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÛŒ Ø±Ø¶Ø§ÛŒÛŒ">
    </div>
    <div>
      <label for="className">Ú©Ù„Ø§Ø³</label>
      <input id="className" name="className" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û·/Û²">
    </div>
    <div>
      <label for="parentPhone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ ÙˆÙ„ÛŒ</label>
      <input id="parentPhone" name="parentPhone" placeholder="Ù…Ø«Ù„Ø§Ù‹: 0912...">
    </div>
    <div>
      <label for="formDate">ØªØ§Ø±ÛŒØ® ØªÚ©Ù…ÛŒÙ„</label>
      <input id="formDate" name="formDate" placeholder="Ù…Ø«Ù„Ø§Ù‹: Û±Û´Û°Û´/Û°Û·/Û±Û´">
    </div>

    <div class="full table-wrap">
      <table aria-label="Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ">
        <thead>
          <tr><th>Ø±ÙˆØ²</th><th>Ù†ÙˆØ¨Øª 1</th><th>Ù†ÙˆØ¨Øª 2</th><th>Ù†ÙˆØ¨Øª 3</th><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th></tr>
        </thead>
        <tbody id="scheduleBody"></tbody>
      </table>
    </div>

    <div>
      <label for="attachment">Ù¾ÛŒÙˆØ³Øª (ØµÙˆØª/Ø¹Ú©Ø³/ÙˆÛŒØ¯Ø¦Ùˆ)</label>
      <input type="file" id="attachment" accept="audio/*,image/*,video/*">
    </div>

    <div class="full">
      <div class="controls">
        <button class="btn" id="saveLocal">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
        <button class="btn" id="toPdf">ğŸ“„ PDF</button>
        <button class="btn" id="whatsapp">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ù¾</button>
        <button class="btn" id="email">âœ‰ï¸ Ø§ÛŒÙ…ÛŒÙ„</button>
        <a class="btn btn-ghost" id="callLink" href="tel:00989367104429">ğŸ“ ØªÙ…Ø§Ø³</a>
        <button class="btn btn-ghost" id="printBtn" style="background:#fff;color:var(--primary);border:1px solid var(--primary)">ğŸ–¨ Ú†Ø§Ù¾</button>
        <button class="btn btn-ghost" id="clearBtn" style="background:#f55;color:#fff">ğŸ§¹ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ</button>
      </div>
      <div class="note">ØªÙˆØ¶ÛŒØ­: Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙˆØ³Øª ÙØ§ÛŒÙ„ Ø¯Ø± ÙˆØ§ØªØ³Ø§Ù¾/Ø§ÛŒÙ…ÛŒÙ„ØŒ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø³Ù¾Ø³ Ø¶Ù…ÛŒÙ…Ù‡ Ú©Ù†ÛŒØ¯.</div>
    </div>
  </div>

  <div class="chrome-launch">
    <a href="intent://Ali1398-ahvaz.github.io/Schoolrazavi/index.html#Intent;scheme=https;package=com.android.chrome;end">ğŸš€ Ø§Ø¬Ø±Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ú©Ø±ÙˆÙ…</a>
  </div>
</div>

<script>
const managerPhone = '989367104429';
const managerEmail = 'favasystemyallali@gmail.com';
const days = ['Ø´Ù†Ø¨Ù‡','ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡'];
const lessons = ['','Ø±ÛŒØ§Ø¶ÛŒ','Ø¹Ù„ÙˆÙ…','Ø§Ø¯Ø¨ÛŒØ§Øª','Ø¹Ø±Ø¨ÛŒ','Ù…Ø·Ø§Ù„Ø¹Ø§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ','Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ','Ù…Ø±ÙˆØ±'];

// build compact table rows with short hour inputs (max 2 chars)
const scheduleBody = document.getElementById('scheduleBody');
days.forEach((day, i) => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="day-cell">${day}</td>
    ${[0,1,2].map(n => `
      <td class="schedule-cell">
        <div class="inline">
          <select class="small-select" name="lesson_${n}_${i}">${lessons.map(l=>`<option value="${l}">${l||'Ø¯Ø±Ø³'}</option>`).join('')}</select>
          <span>â€”</span>
          <input class="small-input" maxlength="2" pattern="[0-9Û°-Û¹]*" title="Ù…Ø«Ø§Ù„: Û¸" name="from_${n}_${i}" placeholder="Û¸">
          <span>ØªØ§</span>
          <input class="small-input" maxlength="2" pattern="[0-9Û°-Û¹]*" title="Ù…Ø«Ø§Ù„: Û¹" name="to_${n}_${i}" placeholder="Û¹">
        </div>
      </td>`).join('')}
    <td><input name="note_${i}" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©ÙˆØªØ§Ù‡" style="width:100%;padding:6px;border:1px solid #e1eef6;border-radius:6px;font-size:13px"></td>
  `;
  scheduleBody.appendChild(tr);
});

// helpers for localStorage
const selector = 'input, select, textarea';
function saveAll(){
  document.querySelectorAll(selector).forEach(el=>{
    const key = 'study_form_' + (el.name || el.id);
    try{ localStorage.setItem(key, el.value || ''); }catch(e){}
  });
  updateSummary();
  alert('Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­Ù„ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.');
}
function loadAll(){
  document.querySelectorAll(selector).forEach(el=>{
    const key = 'study_form_' + (el.name || el.id);
    const v = localStorage.getItem(key);
    if(v !== null) el.value = v;
  });
  updateSummary();
}

document.addEventListener('input', function(e){
  if(e.target && (e.target.matches(selector))){
    const key = 'study_form_' + (e.target.name || e.target.id);
    try{ localStorage.setItem(key, e.target.value || ''); }catch(e){}
    debounceUpdate();
  }
});

// summary
const summaryEl = document.getElementById('summary');
function generateSummary(){
  const name = document.getElementById('studentName').value || '(Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…)';
  const cls = document.getElementById('className').value || '(Ø¨Ø¯ÙˆÙ† Ú©Ù„Ø§Ø³)';
  let cnt = 0;
  document.querySelectorAll('#scheduleBody select').forEach(s=>{ if(s.value) cnt++; });
  return `Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${name} â€” Ú©Ù„Ø§Ø³: ${cls} â€” Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§: ${cnt}`;
}
function updateSummary(){ summaryEl.textContent = generateSummary(); }
let tmr = null;
function debounceUpdate(){ if(tmr) clearTimeout(tmr); tmr = setTimeout(updateSummary,200); }

// attachment preview + store small images
const attachment = document.getElementById('attachment');
attachment.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(evt){
    try{
      localStorage.setItem('study_form_attachment_name', f.name);
      localStorage.setItem('study_form_attachment_type', f.type);
      localStorage.setItem('study_form_attachment_data', evt.target.result);
      alert('ÙØ§ÛŒÙ„ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…Ø­Ù„ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø§Ú¯Ø± Ø­Ø¬Ù… Ø¨Ø²Ø±Ú¯ Ø¨Ø§Ø´Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´ÙˆØ¯).');
    }catch(err){
      console.warn('Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø²ÛŒØ§Ø¯ Ø§Ø³ØªØ› ÙÙ‚Ø· Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙØ±Ø§Ù‡Ù… Ø´Ø¯');
    }
  };
  reader.readAsDataURL(f);
});

// load on start
loadAll();

// clear
document.getElementById('clearBtn').addEventListener('click', ()=>{
  if(!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ÙØ±Ù… Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')) return;
  document.querySelectorAll(selector).forEach(el=>el.value='');
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith('study_form_')) localStorage.removeItem(k); });
  updateSummary();
});

// print/pdf -> use print for simplicity
document.getElementById('printBtn').addEventListener('click', ()=> window.print());
document.getElementById('toPdf').addEventListener('click', ()=> window.print());

// save button
document.getElementById('saveLocal').addEventListener('click', saveAll);

// whatsapp: build compact message
document.getElementById('whatsapp').addEventListener('click', ()=>{
  saveAll();
  const name = encodeURIComponent(document.getElementById('studentName').value || '(Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…)');
  const cls = encodeURIComponent(document.getElementById('className').value || '(Ø¨Ø¯ÙˆÙ† Ú©Ù„Ø§Ø³)');
  let msg = `Ø³Ù„Ø§Ù… Ù…Ø¯ÛŒØ±ØŒ%0AÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯.%0AØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${name}%0AÚ©Ù„Ø§Ø³: ${cls}%0A%0A`;
  days.forEach((d,i)=>{
    let parts = [];
    [0,1,2].forEach(n=>{
      const lesson = document.querySelector(`[name="lesson_${n}_${i}"]`).value || '';
      const from = document.querySelector(`[name="from_${n}_${i}"]`).value || '';
      const to = document.querySelector(`[name="to_${n}_${i}"]`).value || '';
      if(lesson && from && to) parts.push(`${lesson} â€” Ø§Ø² ${from} ØªØ§ ${to}`);
    });
    const note = document.querySelector(`[name="note_${i}"]`).value || '';
    if(parts.length) msg += `${d}: ${parts.join(' | ')}${note? ' â€” ' + encodeURIComponent(note) : ''}%0A`;
  });
  const wa = `https://wa.me/${managerPhone}?text=` + msg;
  window.open(wa, '_blank');
});

// email
document.getElementById('email').addEventListener('click', ()=>{
  saveAll();
  const name = encodeURIComponent(document.getElementById('studentName').value || '(Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…)');
  const cls = encodeURIComponent(document.getElementById('className').value || '(Ø¨Ø¯ÙˆÙ† Ú©Ù„Ø§Ø³)');
  let body = `ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯.%0AØ¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: ${name}%0AÚ©Ù„Ø§Ø³: ${cls}%0A%0A`;
  days.forEach((d,i)=>{
    let parts = [];
    [0,1,2].forEach(n=>{
      const lesson = document.querySelector(`[name="lesson_${n}_${i}"]`).value || '';
      const from = document.querySelector(`[name="from_${n}_${i}"]`).value || '';
      const to = document.querySelector(`[name="to_${n}_${i}"]`).value || '';
      if(lesson && from && to) parts.push(`${lesson} â€” Ø§Ø² ${from} ØªØ§ ${to}`);
    });
    const note = document.querySelector(`[name="note_${i}"]`).value || '';
    if(parts.length) body += `${d}: ${parts.join(' | ')}${note? ' â€” ' + encodeURIComponent(note) : ''}%0A`;
  });
  const subject = encodeURIComponent('ÙØ±Ù… Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙØªÚ¯ÛŒ');
  window.open(`mailto:${managerEmail}?subject=${subject}&body=${body}`, '_blank');
});
</script>
</body>
</html>
